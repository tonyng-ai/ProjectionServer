# Master YAML Configuration for MSSQL to PostgreSQL Sync

# Source Database Configuration (MSSQL)
source:
  type: mssql
  host: localhost
  port: 1433
  database: SourceDB
  username: sa
  password: YourPassword123!
  # Connection string format: sqlserver://username:password@host:port?database=dbname
  
# Target Database Configuration (PostgreSQL)
target:
  type: postgresql
  host: localhost
  port: 5432
  database: targetdb
  username: postgres
  password: postgres
  sslmode: disable
  # Connection string format: postgres://username:password@host:port/dbname?sslmode=disable

# Default Sync Configuration
defaults:
  refresh_rate: 360  # Default refresh rate in seconds (360 = 6 minutes)
  proto_actor_trigger: true  # Enable ProtoActor scheduled trigger
  webapi_trigger: true  # Enable WebAPI trigger
  create_target_table: true  # Auto-create target table if missing

# Table Sync Configurations
tables:
  # Example 1: Full table sync with all fields
  - source_table: dbo.Users
    target_table: public.users
    sync_action: full  # Options: full, incremental, custom
    refresh_rate: 360  # Override default refresh rate (seconds)
    proto_actor_trigger: true
    webapi_trigger: true
    # fields: []  # Empty or omit to sync all fields
    # filter: ""  # Optional: WHERE clause for source query (e.g., "IsActive = 1")
    
  # Example 2: Sync with specific fields only
  - source_table: dbo.Products
    target_table: public.products
    sync_action: full
    refresh_rate: 180  # Sync every 3 minutes
    proto_actor_trigger: true
    webapi_trigger: true
    fields:
      - ProductID
      - ProductName
      - Price
      - CategoryID
      - LastModified
    # filter: "IsDeleted = 0"  # Only sync non-deleted products
    
  # Example 3: Sync with filter
  - source_table: dbo.Orders
    target_table: public.orders
    sync_action: full
    refresh_rate: 600  # Sync every 10 minutes
    proto_actor_trigger: true
    webapi_trigger: true
    fields:
      - OrderID
      - CustomerID
      - OrderDate
      - TotalAmount
      - Status
    filter: "OrderDate >= DATEADD(day, -30, GETDATE())"  # Last 30 days only
    
  # Example 4: Disabled ProtoActor trigger (only manual WebAPI trigger)
  - source_table: dbo.AuditLog
    target_table: public.audit_log
    sync_action: full
    proto_actor_trigger: false  # Disable automatic sync
    webapi_trigger: true  # Only manual trigger via API
    # No filter, sync all fields

# API Server Configuration
api:
  host: 0.0.0.0
  port: 8080
  enable_cors: true

# Projection UI Configuration
projections:
  - id: users-overview
    title: "Users Overview"
    description: "Summary of users with subscription and activity status"
    target_view: public.users
    sync_table: public.users
    header_color: "#1f2937"
    header_text_color: "#f9fafb"
    default_sort:
      column: LastModified
      direction: desc
    group_by:
      - Status
    fields:
      - column: UserID
        label: User ID
        type: number
        sortable: true
      - column: ProductName
        label: Primary Subscription
        type: text
        sortable: true
      - column: LastModified
        label: Last Seen
        type: datetime
        sortable: true
      - column: Status
        label: Status
        type: badge
        sortable: false
    filters:
      - id: status
        column: Status
        label: Status
        type: select
        options:
          - label: Active
            value: Active
          - label: Inactive
            value: Inactive
          - label: Suspended
            value: Suspended
    totals:
      - column: UserID
        label: Total Users
        format: count

  - id: orders-performance
    title: "Orders Performance"
    description: "Recent orders with revenue totals"
    target_view: public.orders
    sync_table: public.orders
    header_color: "#0f766e"
    header_text_color: "#ecfeff"
    default_sort:
      column: OrderDate
      direction: desc
    group_by:
      - Status
    fields:
      - column: OrderID
        label: Order #
        type: number
        sortable: true
      - column: CustomerID
        label: Customer #
        type: number
        sortable: true
      - column: OrderDate
        label: Order Date
        type: date
        sortable: true
      - column: TotalAmount
        label: Total Amount
        type: currency
        sortable: true
      - column: Status
        label: Status
        type: text
        sortable: true
    filters:
      - id: status
        column: Status
        label: Status
        type: select
        options:
          - label: Pending
            value: Pending
          - label: Shipped
            value: Shipped
          - label: Cancelled
            value: Cancelled
      - id: minimum_total
        column: TotalAmount
        label: Minimum Total Amount
        type: number
    totals:
      - column: TotalAmount
        label: Total Revenue
        format: currency
